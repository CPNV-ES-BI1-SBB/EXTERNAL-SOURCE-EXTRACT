@startuml

skinparam classAttributeIconSize 0

class Extractor {
  - http_client : HTTPClient
  - newest_record_stored : JSON
  - oldest_record_retrieved : JSON
  - current_data : JSON
  - max_retries : Integer
  - endpoint : String
  - logger : CLogger
  + extract(http_client : HTTPClient, newest_record_stored: JSON) : JSON
  - handle_duplicate() : void
  - handle_missing() : void
  - get_missing_data(http_client : HTTPClient, oldest_record_retrieved: JSON) : JSON
}

class HTTPClient {
  + get(endpoint: String, params: Hash, headers: Hash, timeout: Integer) : JSON
  - make_request(uri: URI, request: Net::HTTP::Get) : Net::HTTPResponse
  - handle_response(response: Net::HTTPResponse) : JSON
}

class Logger {
  - log_path : String
  - last_log : String
  - file : File
  + Logger(log_path: String)
  + log_info(message: String) : void
  + log_error(error: String) : void
  + archive_log(archive_dir: String) : void
  - write_log(log_message: String) : void
  - timestamp() : String
}

Exception MaxRetriesReachedError {}

Extractor ..> HTTPClient
Extractor ..> Logger
Extractor ..> MaxRetriesReachedError

note as N1
  Title: Updated Class Diagram
  Date: 06.01.2025
  Authors: Beno√Æt Pierrehumbert & Philippe Moeckli
end note

@enduml
